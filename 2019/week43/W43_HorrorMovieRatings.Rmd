---
title: "W43 Horror Movies"
Author: "Sung Inkyung"
date: '2019 10 23'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
### source[Tidy Tuesday screencast: predicting horror movie ratings by david robinson] (https://youtu.be/yFRSTlk3kRQ)
```{r}
library(tidyverse)
library(tidytext)
library(ggforce)
library(lubridate)
library(scales)
library(cowplot)
library(showtext)

font_add_google("Teko")
font_add_google("Poppins")

showtext_opts(dpi = 320)
showtext_auto()
```

```{r}
horror_movies_raw <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-10-22/horror_movies.csv")
```

```{r}
horror_movies <- horror_movies_raw %>% 
  rename(country = release_country) %>%
  select(title, genres, release_date, country, review_rating) %>% 
  mutate(month = month(dmy(release_date)),
         year = year(dmy(release_date))) %>% 
  filter(!is.na(month),
         !is.na(year))

country <- horror_movies%>% 
  group_by(country) %>% 
  summarise(total_country = sum(n())) %>% 
  arrange(desc(total_country)) %>% 
  ungroup() 
```


```{r}
top_released_month <- horror_movies %>% 
  group_by(country, month) %>% 
  summarise(total_month = sum(n())) %>% 
  left_join(country, by = "country") %>% 
  mutate(prc = total_month / total_country,
         prc = round(prc,  2)) %>% 
  ungroup() %>% 
   mutate(month = factor(month, 
                         levels = 1:12, 
                   labels = month.abb))

top <- top_released_month %>% 
  filter(total_country >= 10) %>% 
  select(country, month, prc) %>% 
   filter(prc >= 0.30)

```

```{r}
bag_cols <- c("#b86092", "#721b3e", "#00b7a7")

tol12qualitative = c("#332288", "#6699CC", "#88CCEE", "#44AA99", "#117733", "#999933", "#DDCC77", "#661100", "#CC6677", "#AA4466", "#882255", "#AA4499")

annotation_spain <- top %>% 
  group_by(country, prc) %>% 
  filter(country == "Spain",
         month == "Oct") 

annotation_malaysia <- top %>% 
  group_by(country, prc) %>% 
  filter(country == "Malaysia",
         month == "Feb")

annotation_belgium <- top %>% 
  group_by(country, prc) %>% 
  filter(country == "Belgium",
         month == "Apr")

annotation_korea <- top %>% 
  group_by(country, prc) %>% 
  filter(country == "South Korea",
         month == "Jul") 

p3 <- top_released_month %>% 
  filter(total_country >= 10) %>% 
  mutate(month = fct_reorder(month, total_country)) %>% 
  ggplot(aes(x = month, y = prc, fill = month)) +
  geom_jitter(aes(size = total_month, 
                  fill = month), 
              width = 0.1, 
              alpha = 0.4, 
              shape = 21,
              colour = "#85e21f") +
  geom_boxplot(aes(fill = month), 
               colour = "black", 
               width = 0.4,
               show.legend = FALSE, 
               outlier.shape = NA, 
               alpha = 0.4) +
  geom_mark_circle(data = annotation_spain,
                   aes(label = country,
                   description = "42%"),
                   expand = unit(2, "mm"),
                   label.fontsize = 11,
                   label.fill = bag_cols) +
  geom_mark_circle(data = annotation_malaysia,
                   aes(label = country,
                       description = "38%"),
                   expand = unit(2, "mm"),
                   label.fontsize = 11,
                   label.fill = bag_cols) +
  geom_mark_circle(data = annotation_belgium,
                   aes(label = country,
                       description = "36%"),
                   expand = unit(2, "mm"),
                   label.fontsize = 11,
                   label.fill = bag_cols) +
  geom_mark_circle(data = annotation_korea,
                   aes(label = country,
                       description = "34%"),
                   expand = unit(2, "mm"),
                   label.fontsize = 11,
                   label.fill = bag_cols) +
  geom_hline(yintercept = 0, 
             size = 0.7,
             color =  "#a40000") +
  scale_fill_manual(values = tol12qualitative) +
  scale_x_discrete(limits = month.abb)  +
  scale_y_continuous(breaks = seq(0, 50, 10),
                     labels = scales::percent) +
  labs(x = "", 
       y = "", 
       title = "Monthly distribution of released horror movies since 2012 across countries",
       subtitle = "Each point represents a country and shows the percentage of horror films is released in a given country.\nOctober is known for the release of horror films year-round. However, while many in the West celebrate \nthe horrors of Halloween in October as below, South Korea has a strong horror film trend in the summer.\nBecause nothing beats a spooky movie that cools you down in the hot summer.\n",
       caption = "Source : IMDB | Graphic: Sung Inkyung") +
  theme(legend.position = "none",
        plot.background = element_rect(fill = bag_cols ),
        panel.background = element_rect(fill = bag_cols ),
        plot.title = element_text(family = "Teko", size = 28, color = "gray85"),
        plot.subtitle = element_text(family = "Poppins", size = 11, color = "gray85", lineheight = 1.1,
                                     margin = margin(b = 10)),
        plot.caption = element_text(family = "Poppins", size = 9, color = "gray85"),
        panel.grid = element_blank(),
        axis.text = element_text(family = "Poppins", colour = "black"),
        #axis.text.x = element_text(margin = margin(t = .05, unit = "cm")),
        axis.title.y.left = element_text(family = "Teko", size = 7),
        axis.ticks.x = element_blank(),
        axis.ticks.y = element_blank(),
        plot.margin = margin(10, 10, 10, 10)) 


ggsave("W43_HorrorMovies.png", width = 26.5, height = 17, units = "cm")

```
            
  