---
title: "RamenRatings"
author: "Sung Inkyung"
date: '2019 6 5 '
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggridges)
library(skimr)
library(broom)
library(tidybayes)
library(cowplot)
library(showtext)

font_add_google("Teko")
font_add_google("Lato")

showtext_opts(dpi = 320)
showtext_auto()
```
### source[tidy tuesday by david robinson](https://github.com/dgrtwo/data-screencasts/blob/master/ramen-ratings.Rmd)
### source[tidy tuesday by carsten stann](https://github.com/carstenstann/TidyTuesday/blob/master/2019/2019_23_RamenRatings.Rmd)
```{r}
ramen_ratings <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-06-04/ramen_ratings.csv")
```

```{r}
ramen_ratings_gathered <- ramen_ratings %>%  
  mutate(style = fct_relevel(fct_lump(style, 4), "Other"),
         country = fct_relevel(fct_lump(country, 12), "Other"),
         brand = fct_relevel(fct_lump(brand, 12), "Other"))%>%
  replace_na(list(style = "Other")) %>%  
  drop_na()
```


```{r joint plots}
p1 <- lm(stars ~brand + country + style, ramen_ratings_gathered) %>%   
  tidy(conf.int = TRUE) %>% # for coefficient plot
  filter(term != "(Inercept)") %>%
  arrange(desc(estimate)) %>% 
  extract(term, c("category", "term"), "^([a-z]+)([A-Z].*)") %>% 
  mutate(term = fct_reorder(term, estimate)) %>% 
  drop_na() %>% 
  ggplot(aes(estimate, term, color = category)) +
  geom_point(na.rm = TRUE,
             show.legend = FALSE) +
  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high),
                 show.legend = FALSE) +
  geom_vline(lty =2, 
             color = "#9a2543",
             xintercept = 0) +
  facet_wrap(~ category, ncol = 1, 
             scales = "free_y") +
  scale_color_brewer(palette = "Set2") +
  labs(x = "Coefficient",
       y =" ",
       title = "Categories of Ramen Ratings") +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor = element_blank(),
        plot.title = element_text(family = "Teko", size = 18, margin = margin(b = 7)),
        axis.title = element_blank(),
        axis.text.y = element_text(family = "Lato",
                                   size = 9))


tol11qualitative=c("#332288", "#6699CC", "#88CCEE", "#44AA99", "#117733", 
                   "#999933", "#DDCC77", "#661100", "#CC6677", "#882255",
                   "#AA4499")
 
p2 <- ramen_ratings_gathered  %>% 
  mutate(country = fct_lump(country, 10),
         country = fct_relevel(country, "Other")) %>% 
  ggplot(aes(stars, country)) +
  stat_interval(.width = c(.1, .25, .5, .75, 1),
                 height = 5, 
                 show.legend = FALSE) +
  rcartocolor::scale_colour_carto_d(palette = "Peach") +
  geom_point(aes(stars, country), 
             color = "#4d3093", 
             size = 0.1, 
             alpha = 0.1)+
  geom_vline(lty =2, 
             xintercept = 3.69,
             alpha = 0.8) +
  scale_fill_manual(values = tol11qualitative) +
  labs(title = "Top 10 Countries in Ramen Ratings",
       x = "rating",
       y = " ") +
  theme_minimal()+
  theme(plot.title = element_text(family = "Teko", size = 18),
        plot.subtitle = element_text(family = "Teko", size = 11, 
                                     face = "plain"),
        axis.text.y = element_text(family = "Lato", size = 9))


p3 <- ramen_ratings%>%
  count(country = fct_lump(country, 12), 
        brand = fct_lump(brand, 20), sort=TRUE)%>%
  mutate(colour = case_when(
    country == "United States" ~ "#1B9E77",
    country == "South Korea" ~ "#666666",
    country == "Malaysia" ~ "#66A61E",
    country == "Indonesia" ~ "#7570B3",
    country == "Taiwan" ~ "#A6761D",
    country == "China" ~ "#D95F02",
    country == "Thailand" ~ "#E6AB02",
    country == "Japan" ~ "#E7298A",
    T ~ "#808080"))%>%
  ggplot(aes(x = 0,
             y = fct_rev(factor(country)),
             xend = brand,
             yend = 1, 
             colour= colour,
             alpha = (colour != "grey60")
             ))+
  geom_curve(aes(colour = colour), 
             curvature = -0.5, 
             arrow = arrow(length = unit(0.005, "npc")), 
             show.legend = F) +
  scale_x_discrete() +
  scale_y_discrete() +
  scale_color_identity() +
  scale_size_identity() +
  scale_alpha_manual(values = c(0.1, 0.2), guide = F) +
  scale_size_manual(values = c(0.1, 0.4), guide = F) +
  labs(y = " ",
       x = "brand",
       title = "Top 20 Ramen Brands from their origin countries",
       caption = "Source: The Ramen Rater | Graphic: Sung Inkyung") +
  theme_minimal () +
  theme(legend.position = "none",
        plot.title = element_text(family = "Teko", size = 18),
        plot.caption = element_text(family = "Lato", size = 9),
        axis.text = element_text(family = "Lato", angle = 40, hjust = 1, 
                                  margin = margin(t = -2, r = 0, b = 0, l = 0)),
        panel.grid = element_blank())
```

```{r Layout plots in grid}
plot_grid(p1, plot_grid(p2, p3), 
          ncol = 1, 
          rel_heights = c(1.2, 1))

ggsave("W23_RamenRatings.png", width = 26, height = 25, units = "cm")
```
